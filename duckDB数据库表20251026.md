以下是DuckDB数据库中的所有表结构：

## 1. tblAccountHoldings (账户持仓表)
```sql
CREATE TABLE tblAccountHoldings (
  accountID VARCHAR,
  ticker VARCHAR,
  company VARCHAR,
  costPerShare DOUBLE,
  currency VARCHAR,
  holding INTEGER,
  exchange VARCHAR,
  exchangeCode VARCHAR,
  assetClass VARCHAR,
  description VARCHAR,
  lastUpdated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (accountID, ticker)
);
```

**索引：**
```sql
CREATE INDEX idx_account_ticker ON tblAccountHoldings(accountID, ticker);
CREATE INDEX idx_ticker ON tblAccountHoldings(ticker);
```

**字段说明：**
- `accountID`: 账户ID (主键部分)
- `ticker`: 股票代码 (主键部分) 
- `company`: 公司名称
- `costPerShare`: 每股成本
- `currency`: 货币
- `holding`: 持仓数量
- `exchange`: 交易所名称
- `exchangeCode`: 交易所代码
- `assetClass`: 资产类别 (STK, ETF, BOND等)
- `description`: 描述信息
- `lastUpdated`: 最后更新时间

## 2. tblHoldingAggrView (持仓汇总视图表)
```sql
CREATE TABLE tblHoldingAggrView (
  ticker VARCHAR PRIMARY KEY,
  totalHolding INTEGER,
  avgCostPrice DOUBLE,
  totalCost DOUBLE,
  currentPrice DOUBLE,
  costCNY DOUBLE,
  valueCNY DOUBLE,
  PLRatio DOUBLE,
  costInTotal DOUBLE,
  valueInTotal DOUBLE,
  accountCount INTEGER DEFAULT 1,
  currency VARCHAR,
  calculatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**字段说明：**
- `ticker`: 股票代码 (主键)
- `totalHolding`: 总持仓数量 (跨账户合并)
- `avgCostPrice`: 平均成本价
- `totalCost`: 总成本
- `currentPrice`: 当前价格
- `costCNY`: 成本(人民币)
- `valueCNY`: 市值(人民币)
- `PLRatio`: 损益百分比
- `costInTotal`: 成本占总成本百分比
- `valueInTotal`: 市值占总市值百分比
- `accountCount`: 出现在多少个账户中
- `currency`: 货币
- `calculatedAt`: 计算时间

## 3. tblTaskRecords (任务记录表)
```sql
CREATE TABLE tblTaskRecords (
  taskID VARCHAR PRIMARY KEY,
  taskType VARCHAR,
  accountID VARCHAR,
  ticker VARCHAR,
  changeType VARCHAR,
  oldData JSON,
  newData JSON,
  processed BOOLEAN DEFAULT FALSE,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**字段说明：**
- `taskID`: 任务ID (主键)
- `taskType`: 任务类型
- `accountID`: 账户ID
- `ticker`: 股票代码
- `changeType`: 变更类型 (INSERT, UPDATE, DELETE)
- `oldData`: 旧数据 (JSON格式)
- `newData`: 新数据 (JSON格式)
- `processed`: 是否已处理
- `createdAt`: 创建时间

## 4. tblQuotationTTM (实时报价表)
```sql
CREATE TABLE tblQuotationTTM (
  ticker VARCHAR PRIMARY KEY,
  price DOUBLE,
  currency VARCHAR,
  lastUpdated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**字段说明：**
- `ticker`: 股票代码 (主键)
- `price`: 当前价格
- `currency`: 货币
- `lastUpdated`: 最后更新时间

## 5. tblExchangeRateTTM (汇率表)
```sql
CREATE TABLE tblExchangeRateTTM (
  fromCurrency VARCHAR,
  toCurrency VARCHAR,
  rate DOUBLE,
  lastUpdated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (fromCurrency, toCurrency)
);
```

**字段说明：**
- `fromCurrency`: 源货币 (主键部分)
- `toCurrency`: 目标货币 (主键部分)
- `rate`: 汇率
- `lastUpdated`: 最后更新时间

## 数据库优化设置
```sql
PRAGMA threads=4;
PRAGMA default_order='asc';
PRAGMA memory_limit='1GB';
```

## 数据关系图
```
tblAccountHoldings (多账户持仓数据)
       ↓
tblHoldingAggrView (汇总视图) ← tblQuotationTTM (价格数据)
                               ↖
                            tblExchangeRateTTM (汇率数据)
       ↓
tblTaskRecords (变更记录)
```

## 主要用途
1. **tblAccountHoldings**: 存储各账户的原始持仓数据
2. **tblHoldingAggrView**: 按ticker汇总所有账户的持仓，用于报表和分析
3. **tblTaskRecords**: 记录数据变更，用于后续处理任务
4. **tblQuotationTTM**: 提供实时价格数据
5. **tblExchangeRateTTM**: 提供货币汇率转换

这些表共同构成了完整的投资组合数据分析系统，支持多账户管理、实时数据同步和汇总分析功能。